!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LivePhotos=t():e.LivePhotos=t()}(this,function(){return function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function o(e,t){if(u){p&&n(),"object"==typeof e&&"[object Object]"===e.toString()&&(t=e,e=t.elements,delete t.elements),e||(e="img[data-live-photo]"),"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]);var i=[];return Array.prototype.forEach.call(e,function(e){if("string"==typeof e&&(e=document.querySelector(e)),e){var o=new l(e,t);i.push(o)}}),i}}function n(){d.use(),c++}function r(){p=!1}function a(){for(;c>0;)d.unuse(),c--}function s(e,t){return o(e,t)}var l=i(1),d=i(4),u=!0,c=0,p=!0;s.initialize=o,s.addStyles=n,s.noStyles=r,s.cleanup=a,s.LivePhoto=l,e.exports=s},function(e,t,i){function o(e,t,i,o){var n=document.createElement("video");return n.src=e+(i?"#"+i:""),n.controls=!1,n.muted=o||!1,n.preload="auto",t&&(n.className=t),d(n,!o),n}function n(e,t){if(e.paused){var i=e.muted,o=e.currentTime,n=function(){e.removeEventListener("loadedmetadata",n),e.currentTime=o,t&&t(e)};e.muted=!0,e.play(),e.pause(),e.muted=i,e.duration>=0?n():e.addEventListener("loadedmetadata",n)}}function r(e,t,i){var n=document.createElement("div");n.className="live-photo",n.setAttribute("data-live-photo","");var r=document.createElement("img");r.className="live-photo-keyframe",r.src=e;var a=o(t,"live-photo-postroll",i,!0),s=o(t,"live-photo-video"),l=document.createElement("i");return l.className="live-photo-icon",n.appendChild(r),n.appendChild(a),n.appendChild(s),n.appendChild(l),{container:n,img:r,postroll:a,video:s,icon:l}}function a(){var e=["mousedown"];return u&&e.push("touchstart"),e}function s(){var e=["mouseup","mouseout"];return u&&e.push("touchend"),e}function l(e,t,i,o){if(!(this instanceof l))return new l(e,t,i,o);var n,a;if(e instanceof HTMLElement&&(o=t,a=e,t=a.getAttribute("data-live-photo"),i=parseFloat(a.getAttribute("data-live-photo-still-image-time")),e=a.src),o||(o={}),this.postrollMs=o.postrollMs||375,this.deactivateMs=o.deactivateMs||500,this.previewMs=o.previewMs||500,this.stillImageTime=i||NaN,!e&&!o.noErrors)throw new Error("LivePhoto Error: Missing keyframeUrl");if(!t&&!o.noErrors)throw new Error("LivePhoto Error: Missing videoUrl");n=r(e,t,i),a&&(a.parentNode.insertBefore(n.container,a),a.parentNode.removeChild(a)),this.container=n.container,this.img=n.img,this.video=n.video,this.postroll=n.postroll,this.icon=n.icon,this.__onVideoCanPlayThrough=this._onVideoCanPlayThrough.bind(this),this.__onVideoLoadededMetadata=this._onVideoLoadededMetadata.bind(this),this.__onPostrollTimeUpdate=this._onPostrollTimeUpdate.bind(this),this.__startVideoPlayback=this._startVideoPlayback.bind(this),this.__startPostrollPlayback=this._startPostrollPlayback.bind(this),this.__resetPlayback=this._resetPlayback.bind(this),this.__resetPreview=this._resetPreview.bind(this),this.video.addEventListener("canplaythrough",this.__onVideoCanPlayThrough),this.video.duration?(this._setDuration(this.video.duration),this._resetPostroll()):(this._setDuration(0),this.video.addEventListener("loadedmetadata",this.__onVideoLoadededMetadata)),this._playing=!1,this._canPlayThrough=!1,this._playWhenReady=!1,o.useEventHandlers!==!1&&this._addEventHandlers(o.playEvents,o.stopEvents)}var d=i(2),u="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints;l.prototype={_addEventHandlers:function(e,t){var i=this.container,o=!1,r=this.play.bind(this),l=this.video,d=this.postroll,u=function(e){if(e.preventDefault(),o)r();else{var t=!1,i=!1;n(l,function(){t=!0,i&&r()}),n(d,function(){i=!0,t&&r()}),o=!0}};e&&e!==!1||(e=a),"function"==typeof e&&(e=e(this)),"string"==typeof e&&(e=e.split(/[,\s]+/)),e.forEach(function(e){e&&i.addEventListener(e,u)});var c=this.stop.bind(this),p=function(e){e.preventDefault(),c()};t&&t!==!1||(t=s),"function"==typeof t&&(t=t(this)),"string"==typeof t&&(t=t.split(/[,\s]+/)),t.forEach(function(e){e&&i.addEventListener(e,p)})},_onVideoCanPlayThrough:function(){this._canPlayThrough=!0,this._playWhenReady&&(this._playWhenReady=!1,this.play()),this.container.classList.remove("loading"),this.video.removeEventListener("canplaythrough",this.__onVideoCanPlayThrough)},_onVideoLoadededMetadata:function(){this._setDuration(this.video.duration||0),this._resetPostroll(),this.video.removeEventListener("loadedmetadata",this.__onVideoLoadededMetadata)},_onPostrollTimeUpdate:function(e){this.postroll.currentTime>=this.stillImageTime-.1&&this._resetPreview()},_clearTimeouts:function(){clearTimeout(this._resetVideoTimeout),clearTimeout(this._resetPostrollTimeout),clearTimeout(this._resetPreviewTimeout),this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate)},_setDuration:function(e){this.duration=e,("number"!=typeof this.stillImageTime||isNaN(this.stillImageTime))&&(this.stillImageTime=.5*e),this.previewStart=Math.max(0,this.stillImageTime-this.previewMs/1e3)},_resetPostroll:function(){this.postroll.pause(),this.postroll.currentTime=this.stillImageTime},_resetVideo:function(){this.video.pause(),this.video.currentTime=0,this.video.muted=!1},_startVideoPlayback:function(){this.video.play(),this._resetPostroll()},_startPostrollPlayback:function(){this._resetPostroll(),this.postroll.play()},_resetPlayback:function(){this._playing=!1,this._resetVideo(),this._resetPostroll()},_resetPreview:function(){this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate),this._resetPostroll(),this.container.classList.remove("preview")},load:function(){this.video.load(),this.postroll.load()},play:function(){if(!this._playing){if(!this._canPlayThrough)return this._playWhenReady=!0,this._clearTimeouts(),this.load(),void this.container.classList.add("loading");this._playing=!0,this._clearTimeouts(),this._startPostrollPlayback(),this.video.currentTime=0,this._resetPostrollTimeout=setTimeout(this.__startVideoPlayback,this.postrollMs),this.container.classList.add("active")}},stop:function(){this._playing&&(this.video.muted=!0,this._clearTimeouts(),this.container.classList.remove("active"),this._resetVideoTimeout=setTimeout(this.__resetPlayback,this.deactivateMs))},preview:function(){this._playing||(this._clearTimeouts(),this.postroll.currentTime=this.previewStart,this.postroll.play(),this.container.classList.add("preview"),this._previewCompleteTimeout=setTimeout(this.__resetPreview,1e3*(this.stillImageTime-this.previewStart)),this.postroll.addEventListener("timeupdate",this.__onPostrollTimeUpdate))}},e.exports=l},function(e,t,i){/*! npm.im/iphone-inline-video */
"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}function n(e){function t(n){i=requestAnimationFrame(t),e(n-(o||n)),o=n}var i,o;this.start=function(){i||t(0)},this.stop=function(){cancelAnimationFrame(i),i=null,o=0}}function r(e,t,i,o){function n(t){Boolean(e[i])===Boolean(o)&&t.stopImmediatePropagation(),delete e[i]}return e.addEventListener(t,n,!1),n}function a(e,t,i,o){function n(){return i[t]}function r(e){i[t]=e}o&&r(e[t]),Object.defineProperty(e,t,{get:n,set:r})}function s(e,t,i){i.addEventListener(t,function(){return e.dispatchEvent(new Event(t))})}function l(e,t){Promise.resolve().then(function(){e.dispatchEvent(new Event(t))})}function d(e){var t=new Audio;return s(e,"play",t),s(e,"playing",t),s(e,"pause",t),t.crossOrigin=e.crossOrigin,t.src=e.src||e.currentSrc||"data:",t}function u(e,t,i){(g||0)+200<Date.now()&&(e[T]=!0,g=Date.now()),i||(e.currentTime=t),k[++L%3]=100*t|0}function c(e){return e.driver.currentTime>=e.video.duration}function p(e){var t=this;t.video.readyState>=t.video.HAVE_FUTURE_DATA?(t.hasAudio||(t.driver.currentTime=t.video.currentTime+e*t.video.playbackRate/1e3,t.video.loop&&c(t)&&(t.driver.currentTime=0)),u(t.video,t.driver.currentTime)):t.video.networkState!==t.video.NETWORK_IDLE||t.video.buffered.length||t.video.load(),t.video.ended&&(delete t.video[T],t.video.pause(!0))}function h(){var e=this,t=e[w];return e.webkitDisplayingFullscreen?void e[E]():("data:"!==t.driver.src&&t.driver.src!==e.src&&(u(e,0,!0),t.driver.src=e.src),void(e.paused&&(t.paused=!1,e.buffered.length||e.load(),t.driver.play(),t.updater.start(),t.hasAudio||(l(e,"play"),t.video.readyState>=t.video.HAVE_ENOUGH_DATA&&l(e,"playing")))))}function v(e){var t=this,i=t[w];i.driver.pause(),i.updater.stop(),t.webkitDisplayingFullscreen&&t[P](),i.paused&&!e||(i.paused=!0,i.hasAudio||l(t,"pause"),t.ended&&(t[T]=!0,l(t,"ended")))}function f(e,t){var i=e[w]={};i.paused=!0,i.hasAudio=t,i.video=e,i.updater=new n(p.bind(i)),t?i.driver=d(e):(e.addEventListener("canplay",function(){e.paused||l(e,"playing")}),i.driver={src:e.src||e.currentSrc||"data:",muted:!0,paused:!0,pause:function(){i.driver.paused=!0},play:function(){i.driver.paused=!1,c(i)&&u(e,0)},get ended(){return c(i)}}),e.addEventListener("emptied",function(){var t=!i.driver.src||"data:"===i.driver.src;i.driver.src&&i.driver.src!==e.src&&(u(e,0,!0),i.driver.src=e.src,t?i.driver.play():i.updater.stop())},!1),e.addEventListener("webkitbeginfullscreen",function(){e.paused?t&&!i.driver.buffered.length&&i.driver.load():(e.pause(),e[E]())}),t&&(e.addEventListener("webkitendfullscreen",function(){i.driver.currentTime=e.currentTime}),e.addEventListener("seeking",function(){k.indexOf(100*e.currentTime|0)<0&&(i.driver.currentTime=e.currentTime)}))}function m(e){var t=e[w];e[E]=e.play,e[P]=e.pause,e.play=h,e.pause=v,a(e,"paused",t.driver),a(e,"muted",t.driver,!0),a(e,"playbackRate",t.driver,!0),a(e,"ended",t.driver),a(e,"loop",t.driver,!0),r(e,"seeking"),r(e,"seeked"),r(e,"timeupdate",T,!1),r(e,"ended",T,!1)}function y(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0),i&&!_||e[w]||(f(e,t),m(e),e.classList.add("IIV"),!t&&e.autoplay&&e.play(),"MacIntel"!==navigator.platform&&"Windows"!==navigator.platform||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}var g,b=o(i(3)),_=/iPhone|iPod/i.test(navigator.userAgent)&&void 0===document.head.style.grid,w=b(),T=b(),E=b("nativeplay"),P=b("nativepause"),k=[],L=0;y.isWhitelisted=_,e.exports=y},function(e,t){"use strict";var i="undefined"==typeof Symbol?function(e){return"@"+(e||"@")+Math.random()}:Symbol;e.exports=i},function(e,t,i){var o,n=0,r=i(5);"string"==typeof r&&(r=[[e.id,r,""]]),t.use=t.ref=function(){return n++||(t.locals=r.locals,o=i(7)(r,{})),t},t.unuse=t.unref=function(){--n||(o(),o=null)}},function(e,t,i){t=e.exports=i(6)(),t.push([e.id,".live-photo{position:relative;overflow:hidden;cursor:pointer}.live-photo img,.live-photo video{display:block;max-width:100%;pointer-events:none;-ms-touch-action:none;touch-action:none}.live-photo video{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%}.live-photo video::-webkit-media-controls-start-playback-button{display:none}.live-photo .live-photo-icon{display:block;position:absolute;top:12px;left:12px;width:24px;height:24px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='48' height='48' viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Ctitle%3ELive Photo%3C/title%3E%3Cg fill-rule='evenodd'%3E%3Cpath d='M24 36c6.627 0 12-5.373 12-12s-5.373-12-12-12-12 5.373-12 12 5.373 12 12 12zm0-2c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z'/%3E%3Cpath d='M24 29a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-3a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0-19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.788.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462 1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.849 4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-1.85 4.461a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462 1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM24 44a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.788-.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462-1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM6.13 30.288a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 25.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63-4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.85-4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462-1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z'/%3E%3C/g%3E%3C/svg%3E\") 50%;background-size:contain;-webkit-filter:drop-shadow(0 1px 1px rgba(0,0,0,.5));filter:drop-shadow(0 1px 1px rgba(0,0,0,.5));pointer-events:none}.live-photo .live-photo-postroll,.live-photo .live-photo-video{opacity:0}.live-photo .live-photo-video{-webkit-filter:blur(7.5px);filter:blur(7.5px)}.live-photo .live-photo-keyframe,.live-photo .live-photo-postroll,.live-photo .live-photo-video{will-change:transform,filter,opacity;transition:opacity .5s linear,-webkit-transform .5s ease-out,-webkit-filter .5s linear;transition:transform .5s ease-out,filter .5s linear,opacity .5s linear;transition:transform .5s ease-out,filter .5s linear,opacity .5s linear,-webkit-transform .5s ease-out,-webkit-filter .5s linear}.live-photo.loading .live-photo-icon{-webkit-animation:live-photo-icon-loading .5s linear alternate infinite both;animation:live-photo-icon-loading .5s linear alternate infinite both}.live-photo.preview .live-photo-postroll{opacity:1;transition-duration:0s}.live-photo.active img,.live-photo.active video{-webkit-transform:scale(1.075);transform:scale(1.075)}.live-photo.active .live-photo-postroll{-webkit-animation:live-photo-post-roll 1s both;animation:live-photo-post-roll 1s both}.live-photo.active .live-photo-video{opacity:1;-webkit-filter:none;filter:none;transition-delay:.375s;transition-duration:.625s}@-webkit-keyframes live-photo-icon-loading{0%{opacity:1}to{opacity:.75}}@keyframes live-photo-icon-loading{0%{opacity:1}to{opacity:.75}}@-webkit-keyframes live-photo-post-roll{0%{opacity:0;-webkit-filter:blur(0);filter:blur(0)}2%{opacity:1}37.5%{opacity:1;-webkit-filter:blur(7.5px);filter:blur(7.5px)}to{opacity:0}}@keyframes live-photo-post-roll{0%{opacity:0;-webkit-filter:blur(0);filter:blur(0)}2%{opacity:1}37.5%{opacity:1;-webkit-filter:blur(7.5px);filter:blur(7.5px)}to{opacity:0}}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var i=this[t];i[2]?e.push("@media "+i[2]+"{"+i[1]+"}"):e.push(i[1])}return e.join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},n=0;n<this.length;n++){var r=this[n][0];"number"==typeof r&&(o[r]=!0)}for(n=0;n<t.length;n++){var a=t[n];"number"==typeof a[0]&&o[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="("+a[2]+") and ("+i+")"),e.push(a))}},e}},function(e,t,i){function o(e,t){for(var i=0;i<e.length;i++){var o=e[i],n=h[o.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](o.parts[r]);for(;r<o.parts.length;r++)n.parts.push(d(o.parts[r],t))}else{for(var a=[],r=0;r<o.parts.length;r++)a.push(d(o.parts[r],t));h[o.id]={id:o.id,refs:1,parts:a}}}}function n(e){for(var t=[],i={},o=0;o<e.length;o++){var n=e[o],r=n[0],a=n[1],s=n[2],l=n[3],d={css:a,media:s,sourceMap:l};i[r]?i[r].parts.push(d):t.push(i[r]={id:r,parts:[d]})}return t}function r(e,t){var i=m(),o=b[b.length-1];if("top"===e.insertAt)o?o.nextSibling?i.insertBefore(t,o.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),b.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(t)}}function a(e){e.parentNode.removeChild(e);var t=b.indexOf(e);t>=0&&b.splice(t,1)}function s(e){var t=document.createElement("style");return t.type="text/css",r(e,t),t}function l(e){var t=document.createElement("link");return t.rel="stylesheet",r(e,t),t}function d(e,t){var i,o,n;if(t.singleton){var r=g++;i=y||(y=s(t)),o=u.bind(null,i,r,!1),n=u.bind(null,i,r,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=l(t),o=p.bind(null,i),n=function(){a(i),i.href&&URL.revokeObjectURL(i.href)}):(i=s(t),o=c.bind(null,i),n=function(){a(i)});return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else n()}}function u(e,t,i,o){var n=i?"":o.css;if(e.styleSheet)e.styleSheet.cssText=_(t,n);else{var r=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function c(e,t){var i=t.css,o=t.media;if(o&&e.setAttribute("media",o),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function p(e,t){var i=t.css,o=t.sourceMap;o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var n=new Blob([i],{type:"text/css"}),r=e.href;e.href=URL.createObjectURL(n),r&&URL.revokeObjectURL(r)}var h={},v=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},f=v(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),m=v(function(){return document.head||document.getElementsByTagName("head")[0]}),y=null,g=0,b=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=f()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var i=n(e);return o(i,t),function(e){for(var r=[],a=0;a<i.length;a++){var s=i[a],l=h[s.id];l.refs--,r.push(l)}if(e){var d=n(e);o(d,t)}for(var a=0;a<r.length;a++){var l=r[a];if(0===l.refs){for(var u=0;u<l.parts.length;u++)l.parts[u]();delete h[l.id]}}}};var _=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}()}])});